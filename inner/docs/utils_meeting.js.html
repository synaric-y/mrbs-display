<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>utils/meeting.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="RequestManager.html">RequestManager</a><ul class='methods'><li data-type='method'><a href="RequestManager.html#deleteById">deleteById</a></li><li data-type='method'><a href="RequestManager.html#generateId">generateId</a></li><li data-type='method'><a href="RequestManager.html#generateUniqueId">generateUniqueId</a></li><li data-type='method'><a href="RequestManager.html#serializeObject">serializeObject</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-MeetingFormat.html">MeetingFormat</a><ul class='methods'><li data-type='method'><a href="module-MeetingFormat.html#~formatMeetings">formatMeetings</a></li></ul></li><li><a href="module-Timeline.html">Timeline</a><ul class='methods'><li data-type='method'><a href="module-Timeline.html#.findNextLargerTime">findNextLargerTime</a></li><li data-type='method'><a href="module-Timeline.html#.findPreviousSmallerTime">findPreviousSmallerTime</a></li><li data-type='method'><a href="module-Timeline.html#~fullCheck">fullCheck</a></li><li data-type='method'><a href="module-Timeline.html#~isBothValid">isBothValid</a></li><li data-type='method'><a href="module-Timeline.html#~isCorrectOrder">isCorrectOrder</a></li><li data-type='method'><a href="module-Timeline.html#~isLeftHandleValid">isLeftHandleValid</a></li><li data-type='method'><a href="module-Timeline.html#~isRightHandleValid">isRightHandleValid</a></li></ul></li><li></li></ul><h3>Global</h3><ul><li><a href="global.html#MEETING_EXPIRED">MEETING_EXPIRED</a></li><li><a href="global.html#MEETING_FINISHED">MEETING_FINISHED</a></li><li><a href="global.html#MEETING_IN_PROGRESS">MEETING_IN_PROGRESS</a></li><li><a href="global.html#MEETING_TO_START">MEETING_TO_START</a></li><li><a href="global.html#PAD_QUICK_MEETING_TYPE">PAD_QUICK_MEETING_TYPE</a></li><li><a href="global.html#SEC_PER_HOUR">SEC_PER_HOUR</a></li><li><a href="global.html#SEC_PER_MINUTE">SEC_PER_MINUTE</a></li><li><a href="global.html#TEMPORARY_MEETING_LEGACY">TEMPORARY_MEETING_LEGACY</a></li><li><a href="global.html#TEMPORARY_MEETING_NONE">TEMPORARY_MEETING_NONE</a></li><li><a href="global.html#TEMPORARY_MEETING_VERIFIED">TEMPORARY_MEETING_VERIFIED</a></li><li><a href="global.html#calcTime">calcTime</a></li><li><a href="global.html#ceilScaleTs">ceilScaleTs</a></li><li><a href="global.html#dayTag">dayTag</a></li><li><a href="global.html#generateTimeSequence">generateTimeSequence</a></li><li><a href="global.html#generateTsSequence">generateTsSequence</a></li><li><a href="global.html#getNearestNextHalf">getNearestNextHalf</a></li><li><a href="global.html#getNearestNextTime">getNearestNextTime</a></li><li><a href="global.html#getNearestScale">getNearestScale</a></li><li><a href="global.html#getSettingApi">getSettingApi</a></li><li><a href="global.html#getZeroTimestamp">getZeroTimestamp</a></li><li><a href="global.html#hourFormat">hourFormat</a></li><li><a href="global.html#hrDiff">hrDiff</a></li><li><a href="global.html#hrToTimestamp">hrToTimestamp</a></li><li><a href="global.html#nearestScaleTs">nearestScaleTs</a></li><li><a href="global.html#nextScaleTs">nextScaleTs</a></li><li><a href="global.html#syncRoomApi">syncRoomApi</a></li><li><a href="global.html#timestampDiff">timestampDiff</a></li><li><a href="global.html#timestampHourFormat">timestampHourFormat</a></li><li><a href="global.html#timestampToHr">timestampToHr</a></li><li><a href="global.html#tsDiff">tsDiff</a></li><li><a href="global.html#twoDayDiff">twoDayDiff</a></li><li><a href="global.html#ymdFormat">ymdFormat</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">utils/meeting.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module MeetingFormat */

/**
 * @author Octene
 * @file 会议格式化
 */

import _ from 'lodash'
import i18n from '@/src/i18n.js'
import {
	MEETING_TO_START,
	MEETING_IN_PROGRESS,
	MEETING_FINISHED,
	MEETING_EXPIRED
} from "@/constants/meeting.js"
import { SEC_PER_MINUTE } from '@/constants/time.js'

/**
 *
 * @typedef TimelineMeeting
 * @type {Object} 
 * @property {?Number} id 会议id
 * @property {Number} start_time 开始时间戳
 * @property {Number} end_time 结束时间戳
 * @property {0|1|2|3} status 会议状态：待开始|进行中|已结束|已过时（表示过去的时间）
 * @property {String} text 描述文字
 * @property {String} className 显示的类名
 */


/**
 * @function
 * @author Octene
 * @description 计算可供时间滚动选择器使用的会议列表
 * @param {Number} currentTime 当前时间戳
 * @param {Number} lb 时间下界（含），时间戳
 * @param {Number} ub 时间上界（含），时间戳
 * @param {Array} meetings 待格式化的会议列表
 * @returns {TimelineMeeting[]} 格式化之后的会议列表
*/
const formatMeetings = (currentTime,lb,ub,meetings) => {
	

	// 计算状态
	function getEntryStatus(entry) {
		if (_.inRange(currentTime, entry.start_time, entry.end_time)) return MEETING_IN_PROGRESS // 进行中
		if (currentTime > entry.end_time) return MEETING_FINISHED // 已结束
		return MEETING_TO_START // 待开始
	}

	// 计算文字
	function getEntryText(status) {
		switch(status){
			case MEETING_TO_START: return i18n.global.t('message.fast_meeting.to_start')
			case MEETING_IN_PROGRESS: return i18n.global.t('message.fast_meeting.in_progress')
			case MEETING_FINISHED: return i18n.global.t('message.fast_meeting.finished')
			default: return ''
		}
	}
	
	function getEntryClassName(status) {
		switch(status){
			case MEETING_TO_START: return 'to-start'
			case MEETING_IN_PROGRESS: return 'in-progress'
			case MEETING_FINISHED: return 'disabled'
			case MEETING_EXPIRED: return 'overdue'
			default: return ''
		}
	}
	
	const tempList = [] // 临时数组
	
	// 如果是今天，将先前的几个小时清掉
	tempList.push({
		start_time: lb,
		end_time: Math.min(currentTime, ub),
		status: MEETING_EXPIRED, // 已过去的时间
		text: '',
		className: getEntryClassName(MEETING_EXPIRED)
	})

	_.forEach(meetings, entry => {

		// 去除不在范围内的会议
		if (entry.start_time > ub) return
		if (entry.end_time &lt; lb) return

		const status = getEntryStatus(entry)
		const text = (entry.end_time-entry.start_time>=SEC_PER_MINUTE*15)?getEntryText(status):'' // 大于等于15分钟展示文字
		const className = getEntryClassName(status)
		
		tempList.push({
			id: entry.id,
			start_time: Math.max(entry.start_time, lb), // 截断越界的部分
			end_time: Math.min(ub, entry.end_time),
			status: status, // 待开始，进行中，已结束
			text: text,
			className: className
		})

	})


	// 排序，按每个会议起始时间（防止乱序导致手柄初始化问题）
	const res = _.sortBy(tempList, ['start_time'])
	console.log(res);
	
	return res

}

export {
	formatMeetings
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Thu Dec 05 2024 17:53:16 GMT+0800 (中国标准时间) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
